# Depends:
#  pkg-config, gcc-libs (libgcc & libstdc++)
# Optional depends:
#  libtool, qt5, libiconv, zlib, liblzma (xz), expat, libpng, libjpeg (libjpeg-turbo), libtiff,
#  libjbig, libxpm, libmspack, SDL2, cairo, libsecret, webkit, xtst, libnotify, gnomevfs,
#  gtkprint, gst, mesagl, glu, gl, sm, directfb, pangoxft, pangoft2, Xinerama, Xxf86vm, xmkmf
#
# TODO: use CMake to build
#
# Notes:
#  - libtool required for autoreconf command
#  - DLLs are installed to lib dir

if ${os_win}; then
	depends=(expat libiconv-reb freetype-reb cairo-reb)
else
	depends=(pkg-config)
fi

ver="3.1.2"
ver_base="${ver%.*}"
dname="${name}-${ver}"
fname="${dname}.tar.bz2"
src="https://github.com/wxWidgets/wxWidgets/releases/download/v${ver}/${fname}"

config_opts=(
	--disable-gtktest
	--disable-sdltest
	--with-libpng=sys
	--with-zlib=sys
	--with-expat=sys
)

if ${os_win}; then
	config_opts+=(
		--with-msw
		--with-libjpeg=builtin
		--with-libtiff=builtin
		--with-libxpm=builtin
		--with-libiconv=builtin
		--with-regex=builtin
		--with-liblzma=builtin
	)
	libtype_opts=(
		--enable-shared=yes
		--enable-monolithic
	)
	ldflags+=(-static-libgcc -static-libstdc++)
else
	config_opts+=(
		--disable-mdi # getting linker errors on Linux/Gtk: undefined reference to `vtable for wxMDIClientWindow'
		--with-libjpeg=sys
		--with-libtiff=sys
		--with-libxpm=sys
		--with-libiconv=sys
		--with-regex=sys
		--with-liblzma=sys
	)
	if ${static}; then
		libtype_opts=(--enable-shared=no)
	else
		libtype_opts=(--enable-shared)
	fi
fi

#post_extract() {
#	autoreconf -fiv
#}

if ${os_win}; then
	post_install() {
		mv -v "${install_prefix}/bin/wxrc-${ver_base}" "${install_prefix}/bin/wxrc-${ver_base}.exe"
	}
fi
