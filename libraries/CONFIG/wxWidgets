# Depends:
#  pkg-config, gcc-libs (libgcc & libstdc++)
# Optional depends:
#  libtool, qt5, libiconv, zlib, liblzma (xz), expat, libpng, libjpeg (libjpeg-turbo), libtiff,
#  libjbig, libxpm, libmspack, SDL2, cairo, libsecret, webkit, xtst, libnotify, gnomevfs,
#  gtkprint, gst, mesagl, glu, gl, sm, directfb, pangoxft, pangoft2, Xinerama, Xxf86vm, xmkmf
#
# TODO: use CMake to build
#
# Notes:
#  - libtool required for autoreconf command
#  - DLLs are installed to lib dir

# Bugs to report:
#  - GNU Autotools build:
#    - '--disable/enable-metafiles' does not work
#    - wxrc-<ver> executable not suffixed with .exe on Windows

if ${os_win}; then
	depends=(expat libiconv-reb freetype-reb cairo-reb)
else
	depends=(pkg-config)
fi

ver="3.1.2"
ver_base="${ver%.*}"
dname="${name}-${ver}"
fname="${dname}.tar.bz2"
src="https://github.com/wxWidgets/wxWidgets/releases/download/v${ver}/${fname}"

#cmd_config=(cmake)

gnu_opts=(
	--without-subdirs
	# localization
	--disable-intl
	--disable-xlocale
	--disable-apple_ieee
	--disable-debugreport
	--disable-dialupman
	# audio
	--disable-sound
	# user input
	--disable-joystick
	--disable-mousewheel
	# types support
	--disable-pcx
	--disable-tga
	--disable-iff
	--disable-pnm
	--disable-arcstream
	--disable-tarstream
	--disable-zipstream
	# libraries/dependencies
	--disable-gtktest
	--disable-sdltest
	--with-libpng=sys
	--without-libjpeg
	--without-libtiff
	--with-zlib=sys
	--without-liblzma
	--with-expat=sys
	# misc
	--disable-graphics_ctx
	--disable-artstd
	--disable-arttango
	--disable-svg
	--disable-postscript
	--disable-printarch
	--disable-mediactrl
	--disable-mdi
	--disable-xrc
	--disable-aui
	--disable-config
	#--disable-dataobj # maybe for non-Windows?
	--disable-any
	#--disable-dynlib # maybe for non-Windows?
	--disable-dynamicloader
	--disable-mimetype
	--disable-secretstore
	--disable-propgrid
	--disable-ribbon
	--disable-dnd
	--without-opengl
	--disable-splash
	--disable-hotkey
	--disable-miniframe
	--disable-busyinfo
	--disable-dragimage
	--disable-accessibility
	--disable-uiactionsim
	--disable-palette
	--disable-validators
	--disable-splines
	--disable-wizarddlg
	--disable-progressdlg
	--disable-tipdlg
	#--disable-textdlg # required by "richtextstyledlg" (not sure how to disable)
	--disable-numberdlg
	--disable-finddlg
	--disable-choicedlg
	--disable-aboutdlg
	--disable-sash
	--disable-htmlhelp
	--disable-docview
	--disable-help
	--disable-richmsgdlg # not sure how to disable
	#--disable-coldlg # required by "richtextformatdlg" (not sure how to disable)
	--disable-colourpicker # requires wxColourDialog
	--disable-dirdlg
	--disable-dirpicker # requires wxDirDialog
	--disable-filedlg
	--disable-filepicker # requires wxFileDialog
	--disable-fontdlg
	--disable-fontpicker # requires wxFontDialog
	#--disable-msgdlg # required by wxLogWindow
	--disable-filectrl # requires wxMessageDialog
	--disable-logdialog # requires wxDialog
)

cmake_opts=(
	-DwxBUILD_COMPATIBILITY=3.0
	# localization
	-DwxUSE_INTL=OFF
	-DwxUSE_XLOCALE=OFF
	# no options for GTK & SDL tests???
	-DwxUSE_APPLE_IEEE=OFF
	-DwxUSE_DEBUGREPORT=OFF
	-DwxUSE_DIALUP_MANAGER=OFF
	# audio
	-DwxUSE_SOUND=OFF
	# user input
	-DwxUSE_JOYSTICK=OFF
	-DwxUSE_MOUSEWHEEL=OFF
	# graphics rendering
	-DwxUSE_CAIRO=ON
	# types support
	-DwxUSE_PCX=OFF
	-DwxUSE_TGA=OFF
	-DwxUSE_IFF=OFF
	-DwxUSE_PNM=OFF
	-DwxUSE_ARCHIVE_STREAMS=OFF
	-DwxUSE_TARSTREAM=OFF
	-DwxUSE_ZIPSTREAM=OFF
	# libraries/dependencies
	-DwxUSE_LIBPNG=sys
	-DwxUSE_LIBJPEG=OFF
	-DwxUSE_LIBTIFF=OFF
	-DwxUSE_ZLIB=sys
	-DwxUSE_LIBLZMA=OFF
	-DwxUSE_EXPAT=sys
	# misc
	-DwxUSE_GRAPHICS_CONTEXT=OFF
	-DwxUSE_ARTPROVIDER_STD=OFF
	-DwxUSE_ARTPROVIDER_TANGO=OFF
	-DwxUSE_SVG=OFF
	-DwxUSE_POSTSCRIPT=OFF
	-DwxUSE_PRINTING_ARCHITECTURE=OFF
	-DwxUSE_MEDIACTRL=OFF
	-DwxUSE_MDI=OFF
	-DwxUSE_XRC=OFF
	-DwxUSE_AUI=OFF
	-DwxUSE_CONFIG=OFF
	-DwxUSE_ANY=OFF
	-DwxUSE_DYNAMIC_LOADER=OFF
	-DwxUSE_MIMETYPE=OFF
	-DwxUSE_SECRETSTORE=OFF
	-DwxUSE_PROPGRID=OFF
	-DwxUSE_RIBBON=OFF
	-DwxUSE_DRAG_AND_DROP=OFF
	-DwxUSE_OPENGL=OFF
	-DwxUSE_SPLASH=OFF
	-DwxUSE_HOTKEY=OFF
	-DwxUSE_MINIFRAME=OFF
	-DwxUSE_BUSYINFO=OFF
	-DwxUSE_DRAGIMAGE=OFF
	-DwxUSE_ACCESSIBILITY=OFF
	-DwxUSE_UIACTIONSIMULATOR=OFF
	-DwxUSE_PALETTE=OFF
	-DwxUSE_VALIDATORS=OFF
	-DwxUSE_SPLINES=OFF
	-DwxUSE_WIZARDDLG=OFF
	-DwxUSE_PROGRESSDLG=OFF
	-DwxUSE_TIPWINDOW=OFF # same as "--disable-tipdlg"???
	#-DwxUSE_TEXTDLG=OFF # required by "richtextstyledlg" (not sure how to disable)
	-DwxUSE_NUMBERDLG=OFF
	-DwxUSE_FINDREPLDLG=OFF # same as "--disable-finddlg"???
	-DwxUSE_CHOICEDLG=OFF
	-DwxUSE_ABOUTDLG=OFF
	-DwxUSE_SASH=OFF
	-DwxUSE_HELP=OFF # no equivalent for "--disable-htmlhelp"???
	-DwxUSE_RICHMSGDLG=OFF
	#-DwxUSE_COLOURDLG=OFF # required by "richtextformatdlg" (not sure how to disable)
	#-DwxUSE_COLOURPICKERCTRL=OFF # requires wxColourDialog
	-DwxUSE_DIRDLG=OFF
	-DwxUSE_DIRPICKERCTRL=OFF # requires wxDirDialog
	-DwxUSE_FILEDLG=OFF
	-DwxUSE_FILEPICKERCTRL=OFF # requires wxFileDialog
	-DwxUSE_FONTDLG=OFF
	-DwxUSE_FONTPICKERCTRL=OFF # requires wxFontDialog
	#-DwxUSE_MSGDLG=OFF # required by wxLogWindow
	-DwxUSE_FILECTRL=OFF # requires wxMessageDialog
	-DwxUSE_LOG_DIALOG=OFF # requires wxDialog
)

use_cmake=false
if test "${cmd_config[0]}" == "cmake"; then
	use_cmake=true
fi

if ! ${use_cmake}; then
	# using GNU autotools
	config_opts=(${gnu_opts[@]})

	if ${os_win}; then
		config_opts+=(
			--with-msw
			--disable-dbghelp
			--disable-iniconf
			--disable-mshtmlhelp
			--disable-ownerdrawn
			# types support
			--disable-xpm
			--enable-ico_cur
			# libraries/dependencies
			--without-libxpm
			--with-libiconv=builtin
			--with-regex=builtin
		)
		libtype_opts=(
			--enable-shared=yes
			--enable-monolithic
		)
		ldflags+=(-static-libgcc -static-libstdc++)

		# wxrc-<ver> executable not suffixed with .exe
		post_install() {
			mv -v "${install_prefix}/bin/wxrc-${ver_base}" "${install_prefix}/bin/wxrc-${ver_base}.exe"
		}
	else
		if ${desktop_x11}; then
			config_opts+=(--with-gtk=3)
		fi

		config_opts+=(
			--disable-detect_sm
			--disable-dynlib
			# types support
			--enable-xpm
			--disable-ico_cur
			# libraries/dependencies
			--with-libxpm=sys
			--with-libiconv=sys
			--with-regex=sys
		)
		if ${static}; then
			libtype_opts=(--enable-shared=no)
		else
			libtype_opts=(--enable-shared)
		fi
	fi
else
	# using CMake
	config_opts=(${cmake_opts[@]})

	if ${os_win}; then
		config_opts+=(
			-DwxBUILD_TOOLKIT=msw
			-DwxUSE_DBGHELP=OFF
			-DwxUSE_INICONF=OFF
			-DwxUSE_MS_HTML_HELP=OFF
			-DwxUSE_OWNER_DRAWN=OFF
			# types support
			-DwxUSE_XPM=OFF
			-DwxUSE_ICO_CUR=ON
			# libraries/dependencies
			# libiconv setting???
			-DwxUSE_REGEX=builtin
		)
		libtype_opts=(
			-DwxBUILD_SHARED=ON
			-DwxBUILD_MONOLITHIC=ON
		)
		# FIXME: how to link statically to libgcc & libstdc++???
	else
		if ${desktop_x11}; then
			config_opts+=(-DwxBUILD_TOOLKIT=gtk3)
		fi

		config_opts+=(
			# types support
			-DwxUSE_XPM=ON
			-DwxUSE_ICO_CUR=OFF
			# libraries/dependencies
			-DwxUSE_REGEX=sys
		)
		if ${static}; then
			libtype_opts=(-DwxBUILD_SHARED=OFF)
		else
			libtype_opts=(-DwxBUILD_SHARED=ON)
		fi
	fi
fi

#post_extract() {
#	autoreconf -fiv
#}

unset use_cmake gnu_opts cmake_opts
